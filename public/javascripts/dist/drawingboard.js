!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="/Users/guoshencheng/Documents/OtherProject/node_server/public/javascripts/dist",__webpack_require__(0)}([function(module,exports,__webpack_require__){var canvas=__webpack_require__(1),undo=__webpack_require__(2),drawingboard=__webpack_require__(5)(canvas),image=__webpack_require__(4),pencil=document.getElementById("pencil"),eraser=document.getElementById("eraser"),small=document.getElementById("small_size"),middle=document.getElementById("middle_size"),large=document.getElementById("large_size"),tool=[pencil,eraser],size=[small,middle,large],ajax=__webpack_require__(6);window.goback=undo.goBackInHistory,window.gofront=undo.goForthInHistory,window.clearCanvas=function(){var ctx=canvas.context;ctx.clearRect(0,0,canvas.width,canvas.height),undo.saveHistory()};var setSizeOfElement=function(element){element==large?drawingboard.size=10:element==middle?drawingboard.size=5:drawingboard.size=1},setColorOfElement=function(element){eraser==element?drawingboard.color="transparent":drawingboard.color="#000000"},clicktool=function(){var current=this;setColorOfElement(current),tool.forEach(function(child){child==current?(child.style.backgroundColor="white",child.style.color="black"):(child.style.backgroundColor="black",child.style.color="white")})},clickSize=function(){var current=this;setSizeOfElement(current),size.forEach(function(child){var icon=child.getElementsByClassName("size_icon")[0];child==current?icon.style.backgroundColor="white":icon.style.backgroundColor="black"})},uploadImage=function(username){var data=image.getImage(),base64Data=data.substr(22);ajax({type:"POST",url:"/drawingboard/image",data:JSON.stringify({image:base64Data,name:username}),success:function(data){if(data.param){var param=data.param;window.location.href="/drawingboard/work/"+param+"/me"}}})};window.uploadImage=uploadImage,drawingboard.draw(),size.forEach(function(child){child.clickSize=clickSize,child.addEventListener("touchstart",clickSize)}),tool.forEach(function(child){child.clicktool=clicktool,child.addEventListener("touchstart",clicktool)}),undo.saveHistory(),pencil.clicktool(),small.clickSize();for(var vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]},function(module,exports){var canvas=document.getElementById("drawingboard"),getContext=function(){return canvas&&canvas.getContext&&canvas.getContext("2d")?canvas.getContext("2d"):null},context=getContext();canvas.context=context,canvas.on=function(event,cb){canvas.addEventListener(event,cb,!1)},module.exports=canvas},function(module,exports,__webpack_require__){var SimpleUndo=__webpack_require__(3),image=__webpack_require__(4),history=new SimpleUndo({maxLength:10,provider:function(done){done(image.getImage())}}),saveHistory=function(){history.save()},goBackInHistory=function(){history.undo(image.setImage)},goForthInHistory=function(){history.redo(image.setImage)};module.exports={saveHistory:saveHistory,goBackInHistory:goBackInHistory,goForthInHistory:goForthInHistory}},function(module,exports,__webpack_require__){!function(){"use strict";function truncate(stack,limit){for(;stack.length>limit;)stack.shift()}var SimpleUndo=function(options){var settings=options?options:{},defaultOptions={provider:function(){throw new Error("No provider!")},maxLength:30,onUpdate:function(){}};this.provider="undefined"!=typeof settings.provider?settings.provider:defaultOptions.provider,this.maxLength="undefined"!=typeof settings.maxLength?settings.maxLength:defaultOptions.maxLength,this.onUpdate="undefined"!=typeof settings.onUpdate?settings.onUpdate:defaultOptions.onUpdate,this.initialItem=null,this.clear()};SimpleUndo.prototype.initialize=function(initialItem){this.stack[0]=initialItem,this.initialItem=initialItem},SimpleUndo.prototype.clear=function(){this.stack=[this.initialItem],this.position=0,this.onUpdate()},SimpleUndo.prototype.save=function(){this.provider(function(current){truncate(this.stack,this.maxLength),this.position=Math.min(this.position,this.stack.length-1),this.stack=this.stack.slice(0,this.position+1),this.stack.push(current),this.position++,this.onUpdate()}.bind(this))},SimpleUndo.prototype.undo=function(callback){if(this.canUndo()){var item=this.stack[--this.position];this.onUpdate(),callback&&callback(item)}},SimpleUndo.prototype.redo=function(callback){if(this.canRedo()){var item=this.stack[++this.position];this.onUpdate(),callback&&callback(item)}},SimpleUndo.prototype.canUndo=function(){return this.position>0},SimpleUndo.prototype.canRedo=function(){return this.position<this.count()},SimpleUndo.prototype.count=function(){return this.stack.length-1},module.exports=SimpleUndo,"undefined"!=typeof window&&(window.SimpleUndo=SimpleUndo)}()},function(module,exports,__webpack_require__){var canvas=__webpack_require__(1),getImage=function(){return canvas.toDataURL("image/png")},setImage=function(src){if(src){var ctx=canvas.context,img=new Image,oldGCO=ctx.globalCompositeOperation;img.onload=function(){ctx.globalCompositeOperation="source-over",ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(img,0,0,canvas.width,canvas.height),ctx.globalCompositeOperation=oldGCO},img.src=src}};module.exports={getImage:getImage,setImage:setImage}},function(module,exports,__webpack_require__){var undo=__webpack_require__(2);module.exports=function(canvas){var drawingboard={};drawingboard.canvas=canvas,drawingboard.coords={},drawingboard.drawing=!1,drawingboard.size=1,drawingboard.color="#000000",canvas.context.lineCap="round",canvas.context.lineJoin="round",drawingboard.getInputCoords=function(e){e=e.originalEvent?e.originalEvent:e;var x,y,rect=canvas.getBoundingClientRect(),width=canvas.width,height=canvas.height;return e.touches&&1==e.touches.length?(x=e.touches[0].pageX,y=e.touches[0].pageY):(x=e.pageX,y=e.pageY),x-=canvas.offsetLeft,y-=canvas.offsetTop,x*=width/rect.width,y*=height/rect.height,{x:x,y:y}},drawingboard.getMidInputCoords=function(coords){return{x:drawingboard.coords.old.x+coords.x>>1,y:drawingboard.coords.old.y+coords.y>>1}},drawingboard.draw=function(){if(drawingboard.drawing){var ctx=canvas.context;ctx.lineWidth=drawingboard.size,ctx.strokeStyle=drawingboard.color;var currentMid=drawingboard.getMidInputCoords(drawingboard.coords.current);ctx.beginPath(),ctx.moveTo(currentMid.x,currentMid.y),ctx.quadraticCurveTo(drawingboard.coords.old.x,drawingboard.coords.old.y,drawingboard.coords.oldMid.x,drawingboard.coords.oldMid.y),ctx.stroke(),drawingboard.coords.old=drawingboard.coords.current,drawingboard.coords.oldMid=currentMid}requestAnimationFrame&&requestAnimationFrame(drawingboard.draw)},canvas.on("touchstart",function(e){onTouchStart(e,drawingboard.getInputCoords(e))}),canvas.on("touchmove",function(e){onTouchMove(e,drawingboard.getInputCoords(e))}),canvas.on("touchend",function(e){onTouchStop(e,drawingboard.getInputCoords(e))});var onTouchStart=function(e,coords){drawingboard.coords.current=drawingboard.coords.old=coords,drawingboard.coords.oldMid=drawingboard.getMidInputCoords(coords),drawingboard.drawing=!0,requestAnimationFrame||drawingboard.draw(),e.stopPropagation(),e.preventDefault()},onTouchMove=function(e,coords){drawingboard.coords.current=coords,requestAnimationFrame||drawingboard.draw(),e.stopPropagation(),e.preventDefault()},onTouchStop=function(e,coords){!drawingboard.drawing||e.touches&&0!==e.touches.length||(drawingboard.drawing=!1,undo.saveHistory(),e.stopPropagation(),e.preventDefault())};return drawingboard}},function(module,exports){var ajax=function(cfg){var type=cfg.type,url=cfg.url,data=cfg.data,success=cfg.success,xhr=new XMLHttpRequest;xhr.onloadend=function(){if(XMLHttpRequest.DONE==this.readyState&&200==this.status){var data=JSON.parse(xhr.responseText);data.errMsg?console.log(data.errMsg):success(data)}else console.log("网络异常，请稍后再试。")},xhr.ontimeout=onerror,xhr.open(type,url,!0),xhr.setRequestHeader("accept","application/json"),"POST"==type.toUpperCase()?(xhr.setRequestHeader("Content-Type","application/json;charset=utf-8"),xhr.setRequestHeader("contentType","application/json;charset=utf-8"),xhr.send(data)):xhr.send(null)};module.exports=ajax}]);