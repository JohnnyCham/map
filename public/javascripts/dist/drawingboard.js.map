{"version":3,"sources":["webpack:///webpack/bootstrap bf2064fa44403aafb9dd","webpack:///./public/javascripts/apps/drawingboard/src/index.js","webpack:///./public/javascripts/apps/drawingboard/src/canvas.js","webpack:///./public/javascripts/apps/drawingboard/src/undo.js","webpack:///./public/javascripts/apps/drawingboard/~/simple-undo/lib/simple-undo.js","webpack:///./public/javascripts/apps/drawingboard/src/image.js","webpack:///./public/javascripts/apps/drawingboard/src/drawingboard.js","webpack:///./public/javascripts/apps/drawingboard/src/ajax.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA4B,kCAAkC;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;AAEA;AACA,eAAc,qDAAqD;AACnE;AACA;AACA;;AAEA;AACA,kDAAiD,4CAA4C,GAAG,yCAAyC;AACzI;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6CAA4C,8CAA8C,IAAI,2CAA2C;AACzI;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACrIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;ACzBA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;AACF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,+BAA8B;AAC9B;;;;;;AAMA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,EAAC,I;;;;;;AChHD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5FA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAA+D;AAC/D,+DAA8D;AAC9D;AACA,MAAK;AACL;AACA;AACA;;AAEA","file":"drawingboard.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/guoshencheng/Documents/OtherProject/node_server/public/javascripts/dist\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap bf2064fa44403aafb9dd\n **/","var canvas = require('./canvas')\nvar undo = require('./undo')\nvar drawingboard = require('./drawingboard')(canvas)\nvar image = require('./image')\nvar pencil = document.getElementById('pencil')\nvar eraser = document.getElementById('eraser')\nvar small = document.getElementById('small_size')\nvar middle = document.getElementById('middle_size')\nvar large = document.getElementById('large_size')\nvar tool = [pencil, eraser]\nvar size = [small, middle, large]\nvar ajax = require('./ajax')\n\nwindow.goback = undo.goBackInHistory\nwindow.gofront = undo.goForthInHistory\nwindow.clearCanvas = function() {\n  var ctx = canvas.context\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n  undo.saveHistory()\n}\n\nvar setSizeOfElement = function(element) {\n  if (element == large) {\n    drawingboard.size = 10 \n  } else if (element == middle) {\n    drawingboard.size = 5\n  } else {\n    drawingboard.size = 1\n  }\n}\n\nvar setColorOfElement = function(element) {\n  if (eraser == element) {\n    drawingboard.mode = 'eraser'\n  } else {\n    drawingboard.mode = 'pencil'\n  }\n}\n\nvar clicktool = function() {\n  var current = this\n  setColorOfElement(current)\n  tool.forEach(function(child) {\n    if (child == current) {\n      child.style.backgroundColor = 'white'\n      child.style.color = 'black'\n    } else {\n      child.style.backgroundColor = 'black'\n      child.style.color = 'white'\n    }\n  })\n}\n\nvar clickSize = function() {\n  var current = this\n  setSizeOfElement(current)\n  size.forEach(function(child) {\n    var icon = child.getElementsByClassName('size_icon')[0]\n    if (child == current) {\n      icon.style.backgroundColor = 'white'\n    } else {\n      icon.style.backgroundColor = 'black'\n    }\n  })\n}\n\nvar uploadImage = function(username) {\n  var data = image.getImage()\n  var base64Data = data.substr(22)\n  ajax({\n      type: 'POST',\n      url: '/drawingboard/image',\n      data: JSON.stringify({image: base64Data, name: username}),\n      success: function (data) {\n        if (data.param) {\n          var param = data.param\n          window.location.href = '/drawingboard/work/' + param \n        }\n      }\n  });\n}\nwindow.uploadImage = uploadImage\n\ndrawingboard.draw()\nsize.forEach(function(child) {\n  child.clickSize = clickSize\n  child.addEventListener('touchstart', clickSize)\n})\n\ntool.forEach(function(child) {\n  child.clicktool = clicktool\n  child.addEventListener('touchstart', clicktool)\n})\n\nundo.saveHistory()\npencil.clicktool()\nsmall.clickSize()\n\nvar vendors = ['ms', 'moz', 'webkit', 'o'];\nfor(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n  window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\n  window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];\n}\n\nwindow.clearArtboard = function() {\n  showRyToast('alert_delete_message', '是否继续删除', {text: '删除', onclick: 'confirmClearCanvas()'}, {text: '取消', onclick: 'hideDeleMessage()'})\n}\n\nwindow.hideDeleMessage = function() {\n  hideRyToast('alert_delete_message')\n}\n\nwindow.confirmClearCanvas = function() {\n  clearCanvas()\n  hideDeleMessage()\n}\nwindow.clickUpload = function() {\n  showRyToast('alert_upload', '给这只猫起个名字吧', {text: '上传作品', onclick: 'confirmUploadImage()'},  {text: '我再想想', onclick: 'hideUploadAlert()'})\n}\n\nwindow.hideUploadAlert = function() {\n  hideRyToast('alert_upload')\n}\n\nwindow.confirmUploadImage = function() {\n  var textContainer = document.getElementsByClassName('renyan_mask_text')[0]\n  var username = textContainer.value\n  if (!username || username == '') username = ''\n  if (username.length > 20) {\n    username = username.substring(0, 20)\n  }\n  uploadImage(username)\n  hideUploadAlert()\n}\n\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/src/index.js\n ** module id = 0\n ** module chunks = 0\n **/","var canvas = document.getElementById('drawingboard')\n\nvar getContext = function() {\n  return canvas && canvas.getContext && canvas.getContext('2d') ? canvas.getContext('2d') : null;\n}\nvar context = getContext()\ncanvas.context = context\ncanvas.on = function(event, cb) {\n  canvas.addEventListener(event, cb, false)\n}\n\nmodule.exports = canvas\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/src/canvas.js\n ** module id = 1\n ** module chunks = 0\n **/","var SimpleUndo = require('simple-undo')\nvar image = require('./image')\nvar history = new SimpleUndo({\n  maxLength: 10,\n  provider: function(done) {\n    done(image.getImage())\n  }\n})\n\nvar saveHistory = function() {\n  history.save()\n}\n\nvar goBackInHistory = function() {\n  history.undo(image.setImage)\n}\n\nvar goForthInHistory = function() {\n  history.redo(image.setImage)\n}\n\nmodule.exports = {\n  saveHistory: saveHistory,\n  goBackInHistory: goBackInHistory,\n  goForthInHistory: goForthInHistory\n}\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/src/undo.js\n ** module id = 2\n ** module chunks = 0\n **/","(function() {\n\t\n'use strict';\n\n/**\n * SimpleUndo is a very basic javascript undo/redo stack for managing histories of basically anything.\n * \n * options are: {\n * \t* `provider` : required. a function to call on `save`, which should provide the current state of the historized object through the given \"done\" callback\n * \t* `maxLength` : the maximum number of items in history\n * \t* `opUpdate` : a function to call to notify of changes in history. Will be called on `save`, `undo`, `redo` and `clear`\n * }\n * \n */\nvar SimpleUndo = function(options) {\n\t\n\tvar settings = options ? options : {};\n\tvar defaultOptions = {\n\t\tprovider: function() {\n\t\t\tthrow new Error(\"No provider!\");\n\t\t},\n\t\tmaxLength: 30,\n\t\tonUpdate: function() {}\n\t};\n\t\n\tthis.provider = (typeof settings.provider != 'undefined') ? settings.provider : defaultOptions.provider;\n\tthis.maxLength = (typeof settings.maxLength != 'undefined') ? settings.maxLength : defaultOptions.maxLength;\n\tthis.onUpdate = (typeof settings.onUpdate != 'undefined') ? settings.onUpdate : defaultOptions.onUpdate;\n\t\n\tthis.initialItem = null;\n\tthis.clear();\n};\n\nfunction truncate (stack, limit) {\n\twhile (stack.length > limit) {\n\t\tstack.shift();\n\t}\n}\n\nSimpleUndo.prototype.initialize = function(initialItem) {\n\tthis.stack[0] = initialItem;\n\tthis.initialItem = initialItem;\n};\n\n\nSimpleUndo.prototype.clear = function() {\n\tthis.stack = [this.initialItem];\n\tthis.position = 0;\n\tthis.onUpdate();\n};\n\nSimpleUndo.prototype.save = function() {\n\tthis.provider(function(current) {\n\t\ttruncate(this.stack, this.maxLength);\n\t\tthis.position = Math.min(this.position,this.stack.length - 1);\n\t\t\n\t\tthis.stack = this.stack.slice(0, this.position + 1);\n\t\tthis.stack.push(current);\n\t\tthis.position++;\n\t\tthis.onUpdate();\n\t}.bind(this));\n};\n\nSimpleUndo.prototype.undo = function(callback) {\n\tif (this.canUndo()) {\n\t\tvar item =  this.stack[--this.position];\n\t\tthis.onUpdate();\n\t\t\n\t\tif (callback) {\n\t\t\tcallback(item);\n\t\t}\n\t}\n};\n\nSimpleUndo.prototype.redo = function(callback) {\n\tif (this.canRedo()) {\n\t\tvar item = this.stack[++this.position];\n\t\tthis.onUpdate();\n\t\t\n\t\tif (callback) {\n\t\t\tcallback(item);\n\t\t}\n\t}\n};\n\nSimpleUndo.prototype.canUndo = function() {\n\treturn this.position > 0;\n};\n\nSimpleUndo.prototype.canRedo = function() {\n\treturn this.position < this.count();\n};\n\nSimpleUndo.prototype.count = function() {\n\treturn this.stack.length - 1; // -1 because of initial item\n};\n\n\n\n\n\n//exports\n// node module\nif (typeof module != 'undefined') {\n\tmodule.exports = SimpleUndo;\n}\n\n// browser global\nif (typeof window != 'undefined') {\n\twindow.SimpleUndo = SimpleUndo;\n}\n\n})();\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/~/simple-undo/lib/simple-undo.js\n ** module id = 3\n ** module chunks = 0\n **/","var canvas = require('./canvas')\n\nvar getImage = function() {\n  return canvas.toDataURL('image/png')\n}\n\nvar setImage = function(src) {\n  if (!src) return\n  var ctx = canvas.context\n  var img = new Image()\n  var oldGCO = ctx.globalCompositeOperation\n  img.onload = function() {\n    ctx.globalCompositeOperation = \"source-over\"\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n    ctx.globalCompositeOperation = oldGCO\n  }\n  img.src = src\n}\n\nmodule.exports = {\n  getImage: getImage,\n  setImage: setImage\n}\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/src/image.js\n ** module id = 4\n ** module chunks = 0\n **/","var undo = require('./undo')\nmodule.exports = function(canvas) {\n  var drawingboard = {}\n  drawingboard.mode = 'pencil'\n  drawingboard.canvas = canvas\n  drawingboard.coords = {}\n  drawingboard.drawing = false\n  drawingboard.size = 1 \n  drawingboard.color = '#000000'\n  canvas.context.lineCap = \"round\";\n  canvas.context.lineJoin = \"round\";\n  drawingboard.getInputCoords = function(e) {\n    e = e.originalEvent ? e.originalEvent : e\n    var rect = canvas.getBoundingClientRect()\n    var width = canvas.width\n    var height = canvas.height\n    var x, y\n    if (e.touches && e.touches.length == 1) {\n      x = e.touches[0].pageX\n      y = e.touches[0].pageY   \n    } else {\n      x = e.pageX\n      y = e.pageY\n    }\n    x = x - canvas.offsetLeft\n    y = y - canvas.offsetTop\n    x *= (width / rect.width)\n    y *= (height / rect.height)\n    return {x: x, y: y}\n  }\n\n  drawingboard.getMidInputCoords = function(coords) {\n    return {\n      x: drawingboard.coords.old.x + coords.x >> 1,\n      y: drawingboard.coords.old.y + coords.y >> 1\n    }\n  }\n\n  drawingboard.draw = function() {\n    if (drawingboard.drawing) {\n      var ctx = canvas.context\n      ctx.globalCompositeOperation = drawingboard.mode == 'eraser' ? \"destination-out\" : \"source-over\";\n      ctx.lineWidth = drawingboard.mode == 'pencil' ? drawingboard.size : 3 * drawingboard.size\n      ctx.strokeStyle = drawingboard.color \n      var currentMid = drawingboard.getMidInputCoords(drawingboard.coords.current)\n      ctx.beginPath()\n      ctx.moveTo(currentMid.x, currentMid.y)\n      ctx.quadraticCurveTo(drawingboard.coords.old.x, drawingboard.coords.old.y, drawingboard.coords.oldMid.x, drawingboard.coords.oldMid.y)\n      ctx.stroke()\n      drawingboard.coords.old = drawingboard.coords.current\n      drawingboard.coords.oldMid = currentMid\n  }\n  if (requestAnimationFrame) requestAnimationFrame(drawingboard.draw)\n  }\n  \n  canvas.on('touchstart', function(e) {\n    onTouchStart(e, drawingboard.getInputCoords(e))\n  })\n\n  canvas.on('touchmove', function(e) {\n    onTouchMove(e, drawingboard.getInputCoords(e))\n  })\n\n  canvas.on('touchend', function(e) {\n    onTouchStop(e, drawingboard.getInputCoords(e))\n  })\n  \n  var onTouchStart = function(e, coords) {\n    drawingboard.coords.current = drawingboard.coords.old = coords\n    drawingboard.coords.oldMid = drawingboard.getMidInputCoords(coords)\n    drawingboard.drawing = true\n    if (!requestAnimationFrame) drawingboard.draw()\n    e.stopPropagation()\n    e.preventDefault()\n  }\n\n  var onTouchMove = function(e, coords) {\n    drawingboard.coords.current = coords\n    if (!requestAnimationFrame) drawingboard.draw()\n    e.stopPropagation()\n    e.preventDefault()\n  }\n\n  var onTouchStop = function(e, coords) {\n    if (drawingboard.drawing && (!e.touches || e.touches.length === 0)) {\n      drawingboard.drawing = false\n      undo.saveHistory()\n      e.stopPropagation()\n      e.preventDefault()\n    }\n  }\n  return drawingboard\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/src/drawingboard.js\n ** module id = 5\n ** module chunks = 0\n **/","var ajax = function (cfg) {\n    var type = cfg.type;\n    var url = cfg.url;\n    var data = cfg.data;\n    var success = cfg.success;\n\n    var xhr = new XMLHttpRequest();\n    xhr.onloadend = function () {\n        if (XMLHttpRequest.DONE == this.readyState && this.status == 200) {\n            var data = JSON.parse(xhr.responseText);\n            if (data.errMsg) {\n                console.log(data.errMsg);\n            } else {\n                success(data);\n            }\n        } else {\n            console.log('网络异常，请稍后再试。');\n        }\n    };\n    xhr.ontimeout = onerror;\n    xhr.open(type, url, true);\n    xhr.setRequestHeader('accept', 'application/json');\n    if (type.toUpperCase() == 'POST') {\n        xhr.setRequestHeader('Content-Type', 'application/json;charset=utf-8');\n        xhr.setRequestHeader('contentType', 'application/json;charset=utf-8');\n        xhr.send(data);\n    } else {\n        xhr.send(null);\n    }\n};\n\nmodule.exports = ajax\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/javascripts/apps/drawingboard/src/ajax.js\n ** module id = 6\n ** module chunks = 0\n **/"],"sourceRoot":""}